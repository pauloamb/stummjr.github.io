<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.3">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raspando a web com Jsoup</title>
<link rel="stylesheet" href="./stylesheets/golo.css">
<style>
.CodeRay {
  background-color: hsl(0,0%,95%);
  border: 1px solid silver;
  color: black;
}
.CodeRay pre {
  margin: 0px;
}

span.CodeRay { white-space: pre; border: 0px; padding: 2px; }

table.CodeRay { border-collapse: collapse; width: 100%; padding: 2px; }
table.CodeRay td { padding: 2px 4px; vertical-align: top; }

.CodeRay .line-numbers {
  background-color: hsl(180,65%,90%);
  color: gray;
  text-align: right;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}
.CodeRay .line-numbers a {
  background-color: hsl(180,65%,90%) !important;
  color: gray !important;
  text-decoration: none !important;
}
.CodeRay .line-numbers a:target { color: blue !important; }
.CodeRay .line-numbers .highlighted { color: red !important; }
.CodeRay .line-numbers .highlighted a { color: red !important; }
.CodeRay span.line-numbers { padding: 0px 4px; }
.CodeRay .line { display: block; float: left; width: 100%; }
.CodeRay .code { width: 100%; }

.CodeRay .debug { color: white !important; background: blue !important; }

.CodeRay .annotation { color:#007 }
.CodeRay .attribute-name { color:#b48 }
.CodeRay .attribute-value { color:#700 }
.CodeRay .binary { color:#509 }
.CodeRay .char .content { color:#D20 }
.CodeRay .char .delimiter { color:#710 }
.CodeRay .char { color:#D20 }
.CodeRay .class { color:#B06; font-weight:bold }
.CodeRay .class-variable { color:#369 }
.CodeRay .color { color:#0A0 }
.CodeRay .comment { color:#777 }
.CodeRay .comment .char { color:#444 }
.CodeRay .comment .delimiter { color:#444 }
.CodeRay .complex { color:#A08 }
.CodeRay .constant { color:#036; font-weight:bold }
.CodeRay .decorator { color:#B0B }
.CodeRay .definition { color:#099; font-weight:bold }
.CodeRay .delimiter { color:black }
.CodeRay .directive { color:#088; font-weight:bold }
.CodeRay .doc { color:#970 }
.CodeRay .doc-string { color:#D42; font-weight:bold }
.CodeRay .doctype { color:#34b }
.CodeRay .entity { color:#800; font-weight:bold }
.CodeRay .error { color:#F00; background-color:#FAA }
.CodeRay .escape  { color:#666 }
.CodeRay .exception { color:#C00; font-weight:bold }
.CodeRay .float { color:#60E }
.CodeRay .function { color:#06B; font-weight:bold }
.CodeRay .global-variable { color:#d70 }
.CodeRay .hex { color:#02b }
.CodeRay .imaginary { color:#f00 }
.CodeRay .include { color:#B44; font-weight:bold }
.CodeRay .inline { background-color: hsla(0,0%,0%,0.07); color: black }
.CodeRay .inline-delimiter { font-weight: bold; color: #666 }
.CodeRay .instance-variable { color:#33B }
.CodeRay .integer  { color:#00D }
.CodeRay .key .char { color: #60f }
.CodeRay .key .delimiter { color: #404 }
.CodeRay .key { color: #606 }
.CodeRay .keyword { color:#080; font-weight:bold }
.CodeRay .label { color:#970; font-weight:bold }
.CodeRay .local-variable { color:#963 }
.CodeRay .namespace { color:#707; font-weight:bold }
.CodeRay .octal { color:#40E }
.CodeRay .operator { }
.CodeRay .predefined { color:#369; font-weight:bold }
.CodeRay .predefined-constant { color:#069 }
.CodeRay .predefined-type { color:#0a5; font-weight:bold }
.CodeRay .preprocessor { color:#579 }
.CodeRay .pseudo-class { color:#00C; font-weight:bold }
.CodeRay .regexp .content { color:#808 }
.CodeRay .regexp .delimiter { color:#404 }
.CodeRay .regexp .modifier { color:#C2C }
.CodeRay .regexp { background-color:hsla(300,100%,50%,0.06); }
.CodeRay .reserved { color:#080; font-weight:bold }
.CodeRay .shell .content { color:#2B2 }
.CodeRay .shell .delimiter { color:#161 }
.CodeRay .shell { background-color:hsla(120,100%,50%,0.06); }
.CodeRay .string .char { color: #b0b }
.CodeRay .string .content { color: #D20 }
.CodeRay .string .delimiter { color: #710 }
.CodeRay .string .modifier { color: #E40 }
.CodeRay .string { background-color:hsla(0,100%,50%,0.05); }
.CodeRay .symbol .content { color:#A60 }
.CodeRay .symbol .delimiter { color:#630 }
.CodeRay .symbol { color:#A60 }
.CodeRay .tag { color:#070 }
.CodeRay .type { color:#339; font-weight:bold }
.CodeRay .value { color: #088; }
.CodeRay .variable  { color:#037 }

.CodeRay .insert { background: hsla(120,100%,50%,0.12) }
.CodeRay .delete { background: hsla(0,100%,50%,0.12) }
.CodeRay .change { color: #bbf; background: #007; }
.CodeRay .head { color: #f8f; background: #505 }
.CodeRay .head .filename { color: white; }

.CodeRay .delete .eyecatcher { background-color: hsla(0,100%,50%,0.2); border: 1px solid hsla(0,100%,45%,0.5); margin: -1px; border-bottom: none; border-top-left-radius: 5px; border-top-right-radius: 5px; }
.CodeRay .insert .eyecatcher { background-color: hsla(120,100%,50%,0.2); border: 1px solid hsla(120,100%,25%,0.5); margin: -1px; border-top: none; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; }

.CodeRay .insert .insert { color: #0c0; background:transparent; font-weight:bold }
.CodeRay .delete .delete { color: #c00; background:transparent; font-weight:bold }
.CodeRay .change .change { color: #88f }
.CodeRay .head .head { color: #f4f }

</style>
</head>
<body class="article toc2">
<div id="header">
<h1>Raspando a web com Jsoup</h1>
<span id="author">Prof. Valdir Stumm Júnior - &lt;valdir.stumm@blumenau.ifc.edu.br&gt;</span><br>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ol type="none" class="sectlevel1">
<li><a href="#_introdu_o">Introdução</a></li>
<li><a href="#_html">HTML</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#_atributos_em_elementos_html">Atributos em elementos HTML</a></li>
<li><a href="#_mais_sobre_html">Mais sobre HTML</a></li>
</ol>
</li>
<li><a href="#_jsoup">Jsoup</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#_instala_o">Instalação</a></li>
<li><a href="#_conhecendo_o_jsoup">Conhecendo o Jsoup</a></li>
</ol>
</li>
<li><a href="#_desafio_1">Desafio 1</a></li>
</ol>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introdu_o">Introdução</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://jsoup.org/">JSoup</a> é uma biblioteca Java para manipulação de conteúdo em formato HTML. Com ela, é possível ler e extrair informações de arquivos HTML com facilidade. Você, jogador(a) de <em>League of Legends</em> (LOL), deve acessar com frequência o fórum do LOL no Brasil, para saber de novidades relacionadas ao jogo. O fórum é uma página assim:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/1.png" alt="1" width="500">
</div>

</div>
<div class="paragraph">
<p>Não seria legal poder obter essas informações sem precisar acessar a página toda vez? Que tal um programinha em Java que liste na tela os 10 tópicos mais recentes do fórum? Ou então, um programinha que nos avise quando aparece um tópico novo no fórum?</p>
</div>
<div class="paragraph">
<p>Para que isso seja possível, precisaremos aprender a lidar com duas questões fundamentais:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Como baixar um arquivo HTML da web em Java?</p>
</li>
<li>
<p>Como extrair informações do arquivo HTML baixado?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Este tutorial irá cobrir esses dois tópicos, utilizando o Jsoup como biblioteca de suporte. Em um primeiro momento, vamos dar uma revisada rápida sobre HTML. Depois, vamos ver como utilizar o Jsoup para extrair informações de arquivos HTML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">O que é "raspagem de dados"?</div>
<div class="paragraph">
<p>Raspagem de dados da web (do inglês <em>webscraping</em>) é o ato de utilizar um conjunto de ferramentas para extrair dados de páginas web de forma automatizada. Normalmente, a raspagem de dados é feita por programas que baixam o conteúdo da página e analisam a mesma para extrair informações.</p>
</div>
<div class="paragraph">
<p>Mecanismos de busca, como o Google, utilizam técnicas de raspagem de dados para construção de suas bases de dados de palavras-chave e referências. O software que faz isso é chamado de <em>web crawler</em> e possui a tarefa de varrer a web armazenando as palavras que encontrar e seguir todos os links encontrados nessas páginas.</p>
</div>

</td>
</tr>
</table>
</div>

</div>
</div>
<div class="sect1">
<h2 id="_html">HTML</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://pt.wikipedia.org/wiki/HTML">HTML (<em>HyperText Markup Language</em>)</a> é a linguagem utilizada para definição de páginas na web. O HTML é utilizado basicamente para definir a apresentação de páginas na web. Em geral, as páginas web possuem uma estrutura básica semelhante:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;html&gt;</span>
        <span class="tag">&lt;head&gt;</span>

        <span class="tag">&lt;/head&gt;</span>

        <span class="tag">&lt;body&gt;</span>

        <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada trecho de um código HTML é delimitado por <strong>tags</strong>. Por exemplo, a tag <strong>&lt;html&gt;</strong> delimita o início e o final do documento HTML. Já as tags <strong>&lt;head&gt;</strong> e <strong>&lt;body&gt;</strong> delimitam, respectivamente, o <strong>cabeçalho</strong>, que irá conter metadados sobre a página, e o <strong>corpo</strong> do documento, que será todo o conteúdo da página em si. Cada valor delimitado por uma tag é chamado de <strong>elemento</strong> do HTML.</p>
</div>
<div class="paragraph">
<p>Dentro de um elemento HTML podemos ter outros elementos. Por exemplo:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Uma página qualquer<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content-header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                Aqui vai um conteúdo
                <span class="tag">&lt;a</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">link</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.google.com/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>qualquer<span class="tag">&lt;/a&gt;</span>,
                um texto sem fundamento algum, escrito sem a mínima
                intenção de despertar qualquer interesse por parte
                do <span class="tag">&lt;a</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">link-old</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> leitor<span class="tag">&lt;/a&gt;</span>.
            <span class="tag">&lt;/p&gt;</span>

            <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content-data</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span>16/03/2013<span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>

        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">footer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            Nenhum direito reservado.
        <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dentro do elemento delimitado pela tag <code>body</code>, temos dois elementos <code>div</code>. Dentro do primeiro <code>div</code> (identificado unicamente pelo nome <code>content</code>), temos um parágrafo (<code>p</code>) contendo um texto com dois links <code>a</code> dentro, e outro <code>div</code>, com um parágrafo contento uma data. No segundo <code>div</code> (definido como sendo do tipo <code>footer</code>), temos um apenas um texto. Veja a imagem abaixo para entender melhor a estrutura do HTML.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/3.0.png" alt="3.0" width="400">
</div>

</div>
<div class="paragraph">
<p>Como você pôde ver, um documento HTML é composto por uma estrutura hierárquica de elementos. Cada elemento é composto pelo nome da tag, pelos atributos passados à tag e por nós filhos. Cada elemento dentro de um HTML é "filho" de outro elemento, isto é, está contido dentro de outro elemento, com exceção do "pai" de todos, o elemento raiz, definido pela tag <code>html</code>.</p>
</div>
<div class="paragraph">
<p>Esse documento HTML pode então renderizado por um navegador.</p>
</div>
<div class="sect2">
<h3 id="_atributos_em_elementos_html">Atributos em elementos HTML</h3>
<div class="paragraph">
<p>Um elemento HTML pode possuir atributos, através dos quais são passadas informações adicionais a esse elemento. Por exemplo, um link em uma página web nada mais é do que um elemento do tipo <code>a</code>, com um atributo <code>href</code> contendo o endereço para o qual o link deverá remeter. Veja um exemplo:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">Uma parte deste texto contém <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.google.com.br/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>um link para o Google<span class="tag">&lt;/a&gt;</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Muitas páginas web tem sua estrutura definida em um arquivo HTML e a formatação, como cores, fontes e tamanhos, definida em um arquivo <a href="http://developer.mozilla.org/pt-BR/docs/CSS/Getting_Started">CSS</a>, que é uma linguagem para definição de estilos. Para definir elementos que vão ganhar determinado estilo, os designers das páginas definem o estilo no CSS e, no HTML, "informam" que o elemento pertence a tal classe de estilo. Por exemplo, se houver um estilo chamado <code>container</code>, podemos fazer com que um elemento do tipo <a href="http://pt-br.html.net/tutorials/css/lesson8.php"><code>div</code></a> em nosso HTML tenha esse estilo atribuindo ao seu atributo <code>class</code> o valor <code>containter</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Este texto terá o estilo definido pela classe CSS container.<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Isso facilita bastante o trabalho de quem está escrevendo programas para extrair informações de dentro de códigos HTML. No <a href="http://www.reddit.com/">reddit.com</a>, que lista links interessates sobre os mais variados assuntos, todos os títulos de links estão "marcados" com a classe <code>title</code>. Ou seja, é barbadinha escrever um extrator de informações do reddit, pois basta procurar no HTML dele por elementos que pertençam à classe <code>title</code>. Para melhorar ainda mais, a maioria das bibliotecas para fazer extração de informações de HTML já possuem métodos prontos que fazem isso pra gente.</p>
</div>

</div>
<div class="sect2">
<h3 id="_mais_sobre_html">Mais sobre HTML</h3>
<div class="paragraph">
<p>Para saber mais sobre HTML, leia a <a href="http://developer.mozilla.org/pt-BR/docs/Web/HTML">documentação da Mozilla sobre o assunto</a>. Além disso, para explorar mais as páginas HTML e entender melhor suas estruturas, aprenda a utilizar as "Ferramentas do Desenvolvedor" do Google Chrome (<a href="http://www.youtube.com/watch?v=wGmQGYM5wLM">vídeo explicativo</a>) ou o <a href="http://getfirebug.com/">Firebug</a>, que é um plugin que funciona tanto no Firefox quanto no Chrome.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="_jsoup">Jsoup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agora que já sabemos o que é um arquivo HTML e como ele é composto, podemos começar a brincar de "raspar" as páginas web utilizando a biblioteca Jsoup em nossos programas Java. Mas, antes de mais nada, é preciso "instalar" o Jsoup.</p>
</div>
<div class="sect2">
<h3 id="_instala_o">Instalação</h3>
<div class="paragraph">
<p>Vá até a <a href="http://jsoup.org/download">página de downloads do Jsoup</a> e baixe o arquivo <code>jsoup-x-y-z.jar</code> que estiver listado na página. Observe que <code>x</code>, <code>y</code> e <code>z</code> são números relativos à versão atual do Jsoup, que no momento da escrita deste tutorial era <code>1.7.3</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">Arquivos .jar</div>
<div class="paragraph">
<p>Arquivos .jar são utilizados para agrupar várias classes Java em um único arquivo. Eles são amplamente utilizados para distribuição de bibliotecas de código Java que não estão inclusas na biblioteca-padrão.</p>
</div>

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para que possamos utilizar a biblioteca recém baixada nossos programas, precisaremos adicionar tal biblioteca ao editor no qual estivermos desenvolvendo, para que ele saiba onde procurar as classes quando formos utilizá-las.</p>
</div>
<div class="sect3">
<h4 id="_drjava">DrJava</h4>
<div class="paragraph">
<p>Para adicionar o Jsoup ao DrJava, vá em <em>Edit</em> &#8594; <em>Preferences</em>. Na janela de preferências, no item <em>Resource Locations</em> há um elemento chamado <em>Extra classpath</em>. Clique no botão <em>Add</em> logo abaixo dele, vá até a pasta onde o .jar do Jsoup foi gravado e selecione tal arquivo. Feito isso, clique no botão OK na janela de preferências. A imagem abaixo mostra um pedaço do processo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/2.png" alt="2" width="500">
</div>

</div>
<div class="paragraph">
<p>Agora o DrJava será capaz de compilar e executar código que utiliza o Jsoup.</p>
</div>

</div>
<div class="sect3">
<h4 id="_netbeans">NetBeans</h4>
<div class="paragraph">
<p>No NetBeans, você deverá adicionar o .jar ao projeto no qual quiser utilizar o Jsoup. Com o projeto aberto, clique com o botão direito sobre o nome do projeto e escolha a opção "Propriedades", como mostra a imagem abaixo:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/5.0.png" alt="5.0" width="200">
</div>

</div>
<div class="paragraph">
<p>Na janela de propriedades, selecione a opção "Libraries", então clique em "Add JAR/Folder" (1 na imagem abaixo), selecione o arquivo no seu sistema de arquivos e confirme clicando em "OK" (2 na imagem abaixo).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/5.png" alt="5" width="500">
</div>

</div>
<div class="paragraph">
<p>Feito isso, seu projeto está apto a utilizar a API Jsoup.</p>
</div>

</div>
<div class="sect3">
<h4 id="_testando_a_instala_o">Testando a instalação</h4>
<div class="paragraph">
<p>Para termos certeza de que a instalação está correta, vamos compilar e executar um programa de teste.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>;


<span class="directive">public</span> <span class="type">class</span> <span class="class">Exemplo1</span>
{
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args)
    {
        <span class="keyword">try</span> {
            <span class="predefined-type">Document</span> doc = Jsoup.connect(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://google.com</span><span class="delimiter">&quot;</span></span>).get();
            <span class="predefined-type">String</span> title = doc.title();
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Título : </span><span class="delimiter">&quot;</span></span> + title);
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            e.printStackTrace();
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Salve o código acima em um arquivo chamado <code>Exemplo1.java</code>, compile-o e execute-o. O programa deverá mostrar como resultado o texto: "Título : Google". A imagem abaixo mostra a execução do programa no DrJava.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/3.png" alt="3" width="500">
</div>

</div>
<div class="paragraph">
<p>Agora que o Jsoup está instalado, vamos começar a brincadeira!</p>
</div>

</div>

</div>
<div class="sect2">
<h3 id="_conhecendo_o_jsoup">Conhecendo o Jsoup</h3>
<div class="paragraph">
<p>Antes de escrevermos nossos programas para "hackear" os nossos sites preferidos, precisaremos aprender um pouco mais sobre a estrutura do Jsoup. Com o Jsoup, podemos obter o conteúdo de páginas web e também fazer o <em>parsing</em> do documento HTML retornado.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">O que é parsing?</div>
<div class="paragraph">
<p>Fazer o <em>parsing</em> de um documento significa analisá-lo de forma que seja possível extrair informações sintáticas do mesmo. Por exemplo, após fazer o <em>parsing</em> de um documento HTML, podemos facilmente obter o conteúdo da tag <code>body</code> do documento, pois o <em>parsing</em> já analisou e separou os componentes do arquivo.</p>
</div>
<div class="paragraph">
<p><em>Parsear</em> um documento HTML é uma tarefa bem complicadinha, pois além de existirem muitas variações possíveis sobre a organização do documento, também existem muitos documentos HTML com estruturas inválidas por aí. Os navegadores web acabam renderizando esses documentos sem problemas, mas fazer uma análise sintática do conteúdo não é tão simples assim. Por isso que, ao invés de criarmos nossos próprios mecanismos de análise usando os métodos da classe String, vamos utilizar a biblioteca Jsoup, que faz todo o trabalho "sujo" pra gente.</p>
</div>

</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_baixando_uma_p_gina_com_o_jsoup">Baixando uma página com o Jsoup</h4>
<div class="paragraph">
<p>Para escrever um programinha que "hackeia" o conteúdo do fórum do LOL, a primeira coisa que temos que aprender é como baixar uma página web utilizando o Jsoup. Para fazer isso, vamos utilizar o método estático <a href="http://jsoup.org/apidocs/org/jsoup/Jsoup.html#connect(java.lang.String)"><code>Jsoup.connect()</code></a>. Esse método é definido da seguinte forma:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Connection</span> connect(<span class="predefined-type">String</span> url)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isto é, recebe como parâmetro uma URL (<em>Uniform Resource Location</em>) e retorna como resultado um objeto do tipo <a href="http://jsoup.org/apidocs/org/jsoup/helper/HttpConnection.html"><code>HttpConnection</code></a>. Um dos métodos disponíveis em objetos <code>HttpConnection</code> é o método <a href="http://jsoup.org/apidocs/org/jsoup/Connection.html#get()"><code>get()</code></a>. Esse método realiza as duas operações que precisamos para fazer a análise de uma página web: ele faz o download do conteúdo HTML da URL solicitada e já realiza o <em>parsing</em> do HTML, retornando um objeto do tipo <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html"><code>Document</code></a>. Um objeto <code>Document</code> armazena internamente um documento HTML já analisado, isto é, com suas fatias devidamente separadas. Mais para frente veremos mais detalhes sobre objetos desse tipo.</p>
</div>
<div class="paragraph">
<p>O código para fazer o download e analisar o conteúdo de uma URL é bem simples:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>;

...
        String url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://forums.br.leagueoflegends.com/board/forumdisplay.php?f=13</span><span class="delimiter">&quot;</span></span>;
        <span class="predefined-type">Document</span> doc = Jsoup.connect(url).get();
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">O que significa "hackear" algo?</div>
<div class="paragraph">
<p>Diferentemente do que a cultura popular prega, hackear não significa roubar, invadir ou prejudicar algo ou alguém. Hackear algo significa elaborar uma solução criativa envolvendo conhecimentos especializados para um problema qualquer. Assim, quando dizemos que vamos hackear o fórum do LOL, o que queremos dizer é que vamos obter as informações lá apresentadas, sem precisar acessar o site através de um navegador. Ou seja, estamos criando um mecanismo para facilitar a nossa vida, com base em conhecimentos específicos que temos (Java e Jsoup).</p>
</div>

</td>
</tr>
</table>
</div>

</div>
<div class="sect3">
<h4 id="_obtendo_elementos_da_p_gina">Obtendo elementos da página</h4>
<div class="paragraph">
<p>Um elemento de uma página web é qualquer coisa delimitada por tags dentro da página. Por exemplo, um link é um elemento delimitado pela tag <strong>a</strong> (<code>&lt;a href="..."&gt;...&lt;/a&gt;</code>). Uma imagem é um elemento delimitado pela tag <strong>img</strong> (<code>&lt;img src="..."&gt;...&lt;/img&gt;</code>). O corpo do documento HTML é um elemento, delimitado pela tag <strong>body</strong>, e assim por diante. Elementos estruturais do HTML, como <strong>head</strong>, <strong>title</strong> e <strong>body</strong> podem ser obtidos por chamadas aos métodos <code>head()</code>, <code>title()</code> e <code>body()</code>, respectivamente. Por exemplo, se chamarmos o método <code>title()</code> sobre o <code>Document</code> retornado pelo método <code>get()</code>, vamos obter o título da página baixada. Veja:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>;

...
        String url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://forums.br.leagueoflegends.com/board/forumdisplay.php?f=13</span><span class="delimiter">&quot;</span></span>;
        <span class="predefined-type">Document</span> doc = Jsoup.connect(url).get();
        <span class="predefined-type">System</span>.out.println(doc.title());
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se executarmos o código acima, teremos como saída:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>Comunidade League of Legends</pre>
</div>
</div>
<div class="paragraph">
<p>Legal, não? Agora tente imprimir o conteúdo da tag <strong>body</strong> do fórum do LOL.</p>
</div>
<div class="sect4">
<h5 id="_acessando_elementos_espec_ficos">Acessando elementos específicos</h5>
<div class="paragraph">
<p>Além dos elementos estruturais mais comuns, também podemos acessar os demais elementos da página. Usaremos o método <code>select()</code> do objeto <code>Document</code> retornado pelo <code>get()</code> para obter elementos individuais da página baixada, como por exemplo um link, uma imagem, uma célula de uma tabela, etc.</p>
</div>
<div class="paragraph">
<p>Por exemplo, para obter todas as imagens que aparecem na listagem de tópicos no fórum do LOL, podemos fazer o seguinte:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Element</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Elements</span>;

...
        String url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://forums.br.leagueoflegends.com/board/forumdisplay.php?f=13</span><span class="delimiter">&quot;</span></span>;
        <span class="predefined-type">Document</span> doc = Jsoup.connect(url).get();
        Elements elements = doc.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">img</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="integer">0</span>; i &lt; elements.size(); i++) {
                <span class="predefined-type">System</span>.out.println( elements.get(i) );
        }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>O método <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#select(java.lang.String)"><code>select()</code></a> retorna um objeto do tipo <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html"><code>Elements</code></a>, que é um conjunto de objetos <code>Element</code>, cada um representando um dos elementos retornados. No caso da nossa consulta, todos os elementos serão relativos à tags <strong>img</strong>.</p>
</div>
<div class="paragraph">
<p>A saída do programa acima será parecida com:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
&lt;img src="lol_theme/img/staff_post_icon.gif" alt="Riot Post" /&gt;
...</pre>
</div>
</div>

</div>
<div class="sect4">
<h5 id="_filtrando_elementos_por_atributos_da_tag">Filtrando elementos por atributos da tag</h5>
<div class="paragraph">
<p>Se quisermos obter todos os links de uma determinada página, vamos utilizar o método <code>select()</code> novamente, mas dessa vez passando uma informação adicional. Um link em HTML é composto por uma tag <strong>a</strong> contendo um atributo <strong>href</strong> com o valor da URL. Veja um exemplo de um link:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>&lt;a href="http://www.google.com.br"&gt; texto do link &lt;/a&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assim, para obter todas as tags <strong>a</strong> que contenham um atributo <strong>href</strong>, podemos passar ao <code>select()</code> <strong>o nome da tag com o nome do atributo entre colchetes</strong>:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>Elements elements = doc.select("a[href]");</pre>
</div>
</div>
<div class="paragraph">
<p>Portanto, para obter os elementos do HTML que possuem determinado atributo, basta passar <code>nome da tag[nome do atributo]</code> ao método <code>select()</code>.</p>
</div>

</div>
<div class="sect4">
<h5 id="_filtrando_elementos_pela_classe_css">Filtrando elementos pela classe CSS</h5>
<div class="paragraph">
<p>Muitas vezes, o desenvolvedor da página utiliza classes CSS para classificar os elementos do seu layout. Quem desenvolveu o fórum do LOL, <strong>marcou</strong> todos os títulos das páginas com a classe CSS <code>thread-title-link</code>. Ou seja, dentro do HTML da página, todos os elementos que representam títulos de posts no fórum são tags <strong>a</strong> contendo <code>"thread-title-link"</code> como valor do atributo <code>class</code>. Veja na imagem abaixo:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/img/4.png" alt="4" width="700">
</div>

</div>
<div class="paragraph">
<p>Para obter os elementos de uma <strong>tag</strong> marcada com uma classe CSS, podemos continuar usando o método <code>select()</code>, mas agora passando o nome da <strong>tag</strong> e o nome da classe CSS em questão, unidos por um ponto:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java">Elements e = doc.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">a.thread-title-link</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Portanto, para obter os elementos que foram declarados com determinada classe CSS, podemos passar o nome da classe logo após o ponto. Por exemplo: <code>div.codigo</code>, que representa todas os elementos do tipo <code>div</code>, que possuam <code>codigo</code> como classe, como o <code>div</code> apresentado abaixo:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">codigo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                algum conteúdo qualquer
                aqui
        <span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>

</div>

</div>
<div class="sect3">
<h4 id="_obtendo_os_t_tulos_do_f_rum_do_lol">Obtendo os títulos do Fórum do LOL</h4>
<div class="paragraph">
<p>Você já deve ter percebido que, para cada informação que quisermos extrair de uma página, precisaremos antes analisar o HTML da página para definir como extrair tal informação da página.
O que queremos extrair da página principal do fórum do LOL são os títulos dos tópicos listados nela. Analisando o HTML dessa página, vimos que cada título de tópico está envolto de uma tag <strong>a</strong> parecida com:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="html language-html">        <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">showthread.php?t=82704</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thread_title_82704</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">float-left thread-title-link thread-status_new</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                RP Bônus Extra por tempo limitado
        <span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Com o que vimos na seção anterior, fica fácil obter todos os títulos de posts da página principal do fórum do LOL. Veja:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Element</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>;
<span class="keyword">import</span> <span class="include">org.jsoup.select.Elements</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ListadorDeTopicosLOL</span>
{
        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args)
        {
                <span class="predefined-type">String</span> url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://forums.br.leagueoflegends.com/board/forumdisplay.php?f=13</span><span class="delimiter">&quot;</span></span>;
                <span class="keyword">try</span> {
                    <span class="predefined-type">Document</span> doc = Jsoup.connect(url).get();
                    Elements e = doc.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">a.thread-title-link</span><span class="delimiter">&quot;</span></span>);
                    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; e.size(); i++) {
                        <span class="predefined-type">System</span>.out.println(e.get(i).text());
                    }
                } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
                    e.printStackTrace();
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Executando o código acima, obteremos os seguintes resultados:</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>Pré-Temporada: discurso aos Invocadores
As transferências para o Brasil estão abertas
RP Bônus Extra por tempo limitado
Indique um Amigo
Promoção: Compre duas páginas de runas pelo preço de uma
Começa a batalha por Freljord
Riot Contrata!!
Como resgatar sua skin Tristana Garota Riot
Nidalee Caçadora de Cabeças está disponível
Procura-se: Contador
Campeão em Destaque: o relançamento de Katarina
Recompensa da página brasileira no Facebook
Notas de Atualização da Ilha das Sombras
Rotação de Campeões Grátis: semana 9
Lissandra e skins de Freljord disponíveis
Rotação de Campeões Grátis: semana 10
Revelamos Zac, a Arma Secreta
...</pre>
</div>
</div>
<div class="paragraph">
<p>Cada elemento contido no objeto <code>e</code> (do tipo <code>Elements</code>) é um objeto <code>Element</code> e como tal, possui um nome de tag, atributos e conteúdo. Essas propriedades podem ser obtidas através de chamadas aos seguintes métodos:</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>nodeName()</code> ou <code>tagName()</code>: retorna o nome da tag.</p>
</li>
<li>
<p><code>text()</code>: retorna o somente texto contido no elemento em questão, sem código HTML.</p>
</li>
<li>
<p><code>html()</code>: retorna o conteúdo do elemento em questão, incluindo o código HTML.</p>
</li>
<li>
<p><code>val()</code>: retorna o valor contido num elemento do tipo <code>input</code> de um formulário.</p>
</li>
<li>
<p><code>getAllElements()</code>: retorna todos os elementos contidos no elemento no qual o método for chamado.</p>
</li>
<li>
<p><code>getElementsByAttribute(String attr)</code>: retorna todos os elementos contidos que tem um atributo nomeado com nome passado como parâmetro.</p>
</li>
<li>
<p><code>getElementsByClass(String className)</code>: retorna todos os elementos contidos no elemento em questão que pertencem à classe <code>className</code>.</p>
</li>
</ul>
</div>

</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="_desafio_1">Desafio 1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sabendo como obter e filtrar o conteúdo de uma página web, escreva um programa que monitore o fórum do LOL e emita um aviso sonoro quando houver uma nova postagem.</p>
</div>

</div>
</div>

</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-05-03 17:03:02 BRT
</div>
</div>
</body>
</html>